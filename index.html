<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì‹¤ì‹œê°„ ê²½ì œì§€í‘œ ëŒ€ì‹œë³´ë“œ</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.7/dist/chart.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
<style>
:root {
  --bg: #f5f6fa; --card: #fff; --text: #1a1a2e; --text2: #6b7280;
  --border: #e5e7eb; --up: #ef4444; --down: #3b82f6; --accent: #6366f1;
  --card-hover: #f9fafb; --chart-bg: #fff; --tab-bg: #e5e7eb; --tab-active: #fff;
  --shadow: 0 1px 3px rgba(0,0,0,.08); --shadow-lg: 0 4px 12px rgba(0,0,0,.1);
}
.dark {
  --bg: #0f172a; --card: #1e293b; --text: #f1f5f9; --text2: #94a3b8;
  --border: #334155; --card-hover: #263348; --chart-bg: #1e293b;
  --tab-bg: #334155; --tab-active: #1e293b; --shadow: 0 1px 3px rgba(0,0,0,.3);
  --shadow-lg: 0 4px 12px rgba(0,0,0,.4);
}
* { margin:0; padding:0; box-sizing:border-box; }
body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif; background:var(--bg); color:var(--text); transition:background .3s,color .3s; min-height:100vh; }
.header { display:flex; justify-content:space-between; align-items:center; padding:12px 16px; background:var(--card); border-bottom:1px solid var(--border); position:sticky; top:0; z-index:100; }
.header h1 { font-size:16px; font-weight:700; }
.header-right { display:flex; align-items:center; gap:8px; }
.status { font-size:11px; color:var(--text2); }
.status .dot { display:inline-block; width:6px; height:6px; border-radius:50%; background:#22c55e; margin-right:4px; animation:pulse 2s infinite; }
@keyframes pulse { 0%,100%{opacity:1} 50%{opacity:.4} }
.dark-toggle { background:none; border:1px solid var(--border); border-radius:8px; padding:6px 10px; cursor:pointer; font-size:14px; color:var(--text); }
.tabs { display:flex; gap:4px; padding:8px 16px; background:var(--card); border-bottom:1px solid var(--border); overflow-x:auto; }
.tab { padding:6px 14px; border-radius:8px; border:none; background:var(--tab-bg); color:var(--text2); font-size:13px; font-weight:500; cursor:pointer; white-space:nowrap; transition:all .2s; }
.tab.active { background:var(--accent); color:#fff; }
.cards { display:grid; grid-template-columns:repeat(auto-fill,minmax(150px,1fr)); gap:8px; padding:12px 16px; }
@media(min-width:768px){ .cards{grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:12px;padding:16px 24px;} }
.card { background:var(--card); border:1px solid var(--border); border-radius:12px; padding:12px; cursor:pointer; transition:all .2s; box-shadow:var(--shadow); position:relative; overflow:hidden; }
.card:hover { box-shadow:var(--shadow-lg); transform:translateY(-1px); }
.card.selected { border-color:var(--accent); box-shadow:0 0 0 2px rgba(99,102,241,.3); }
.card .name { font-size:11px; color:var(--text2); font-weight:500; margin-bottom:4px; }
.card .price { font-size:18px; font-weight:700; margin-bottom:2px; }
.card .change { font-size:12px; font-weight:600; }
.card .change.up { color:var(--up); }
.card .change.down { color:var(--down); }
.card .sparkline { position:absolute; bottom:0; left:0; right:0; height:30px; opacity:.15; }
.card.loading .price,.card.loading .change { background:var(--border); color:transparent; border-radius:4px; animation:shimmer 1.5s infinite; }
@keyframes shimmer { 0%{opacity:.6} 50%{opacity:1} 100%{opacity:.6} }
.chart-container { margin:0 16px 16px; background:var(--chart-bg); border:1px solid var(--border); border-radius:12px; padding:16px; box-shadow:var(--shadow); display:none; }
.chart-container.visible { display:block; animation:fadeIn .3s; }
@keyframes fadeIn { from{opacity:0;transform:translateY(8px)} to{opacity:1;transform:none} }
.chart-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; flex-wrap:wrap; gap:8px; }
.chart-title { font-size:15px; font-weight:700; }
.range-btns { display:flex; gap:4px; }
.range-btn { padding:4px 10px; border-radius:6px; border:1px solid var(--border); background:none; color:var(--text2); font-size:11px; cursor:pointer; transition:all .2s; }
.range-btn.active { background:var(--accent); color:#fff; border-color:var(--accent); }
.chart-wrap { position:relative; height:250px; }
@media(min-width:768px){ .chart-wrap{height:350px;} .header h1{font-size:18px;} }
.chart-info { display:flex; gap:16px; margin-top:8px; font-size:12px; color:var(--text2); flex-wrap:wrap; }
.error-msg { text-align:center; padding:40px 16px; color:var(--text2); font-size:13px; }
.footer { text-align:center; padding:16px; font-size:11px; color:var(--text2); }
</style>
</head>
<body>
<div class="header">
  <h1>ğŸ“Š ê²½ì œì§€í‘œ ëŒ€ì‹œë³´ë“œ</h1>
  <div class="header-right">
    <span class="status"><span class="dot"></span><span id="updateTime">ë¡œë”©ì¤‘...</span></span>
    <button class="dark-toggle" onclick="toggleDark()" title="ë‹¤í¬ëª¨ë“œ">ğŸŒ™</button>
  </div>
</div>
<div class="tabs" id="tabs"></div>
<div class="cards" id="cards"></div>
<div class="chart-container" id="chartContainer">
  <div class="chart-header">
    <span class="chart-title" id="chartTitle"></span>
    <div class="range-btns" id="rangeBtns"></div>
  </div>
  <div class="chart-wrap"><canvas id="mainChart"></canvas></div>
  <div class="chart-info" id="chartInfo"></div>
</div>
<div class="footer">Yahoo Finance ë°ì´í„° Â· 30ì´ˆ ìë™ ê°±ì‹ </div>

<script>
const CATEGORIES = [
  { id:'indices', name:'ì£¼ê°€ì§€ìˆ˜', tickers:[
    {sym:'^GSPC',name:'S&P 500',dp:2},{sym:'^IXIC',name:'ë‚˜ìŠ¤ë‹¥',dp:2},{sym:'^DJI',name:'ë‹¤ìš°ì¡´ìŠ¤',dp:2},
    {sym:'^KS11',name:'ì½”ìŠ¤í”¼',dp:2},{sym:'^KQ11',name:'ì½”ìŠ¤ë‹¥',dp:2}
  ]},
  { id:'rates', name:'í™˜ìœ¨Â·ê¸ˆë¦¬', tickers:[
    {sym:'KRW=X',name:'ë‹¬ëŸ¬/ì›',dp:2},{sym:'^TNX',name:'ë¯¸êµ­ì±„10Y',dp:3,suffix:'%'},{sym:'^VIX',name:'VIX',dp:2}
  ]},
  { id:'commodities', name:'ì›ìì¬', tickers:[
    {sym:'GC=F',name:'ê¸ˆ',dp:2,prefix:'$'},{sym:'SI=F',name:'ì€',dp:3,prefix:'$'},
    {sym:'HG=F',name:'êµ¬ë¦¬',dp:4,prefix:'$'},{sym:'CL=F',name:'WTIìœ ',dp:2,prefix:'$'}
  ]}
];
const RANGES = [
  {label:'1ì¼',range:'1d',interval:'5m'},
  {label:'1ì£¼',range:'5d',interval:'15m'},
  {label:'1ê°œì›”',range:'1mo',interval:'1d'},
  {label:'3ê°œì›”',range:'3mo',interval:'1d'},
  {label:'1ë…„',range:'1y',interval:'1wk'},
  {label:'5ë…„',range:'5y',interval:'1mo'}
];

let activeCat = 'indices', selectedTicker = null, currentRange = '1d', chartInstance = null;
const cache = {};

function fmt(n, dp=2, prefix='', suffix='') {
  if(n==null||isNaN(n)) return '-';
  const s = Math.abs(n).toLocaleString('en-US',{minimumFractionDigits:dp,maximumFractionDigits:dp});
  return prefix + (n<0?'-':'') + s + suffix;
}

function toggleDark() {
  document.body.classList.toggle('dark');
  document.querySelector('.dark-toggle').textContent = document.body.classList.contains('dark') ? 'â˜€ï¸' : 'ğŸŒ™';
  if(chartInstance) updateChartColors();
}

// Tabs
function renderTabs() {
  const el = document.getElementById('tabs');
  el.innerHTML = CATEGORIES.map(c =>
    `<button class="tab ${c.id===activeCat?'active':''}" onclick="switchCat('${c.id}')">${c.name}</button>`
  ).join('');
}

function switchCat(id) {
  activeCat = id;
  selectedTicker = null;
  document.getElementById('chartContainer').classList.remove('visible');
  renderTabs(); renderCards();
}

// Cards
function renderCards() {
  const cat = CATEGORIES.find(c=>c.id===activeCat);
  const el = document.getElementById('cards');
  el.innerHTML = cat.tickers.map(t => {
    const d = cache[t.sym];
    const sel = selectedTicker===t.sym ? 'selected' : '';
    const loading = !d ? 'loading' : '';
    const price = d ? fmt(d.price, t.dp, t.prefix||'', t.suffix||'') : '---';
    const chg = d ? d.changePercent : 0;
    const chgClass = chg>0?'up':chg<0?'down':'';
    const chgText = d ? `${chg>0?'+':''}${chg.toFixed(2)}%` : '-';
    return `<div class="card ${sel} ${loading}" onclick="selectTicker('${t.sym}')">
      <div class="name">${t.name}</div>
      <div class="price">${price}</div>
      <div class="change ${chgClass}">${chgText}</div>
    </div>`;
  }).join('');
}

async function fetchYahoo(url) {
  try {
    const r = await fetch(url);
    if(r.ok) return await r.json();
  } catch(e) {}
  try {
    const proxy = 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url);
    const r = await fetch(proxy);
    if(r.ok) return await r.json();
  } catch(e) {}
  return null;
}

async function fetchQuote(sym) {
  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(sym)}?range=1d&interval=5m`;
  const data = await fetchYahoo(url);
  if(!data?.chart?.result?.[0]) return null;
  const r = data.chart.result[0];
  const meta = r.meta;
  const price = meta.regularMarketPrice;
  const prev = meta.chartPreviousClose || meta.previousClose;
  const change = price - prev;
  const changePercent = prev ? (change/prev)*100 : 0;
  return { price, prev, change, changePercent };
}

async function fetchChart(sym, range, interval) {
  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${encodeURIComponent(sym)}?range=${range}&interval=${interval}`;
  const data = await fetchYahoo(url);
  if(!data?.chart?.result?.[0]) return null;
  const r = data.chart.result[0];
  const ts = r.timestamp || [];
  const closes = r.indicators?.quote?.[0]?.close || [];
  return ts.map((t,i) => ({x:t*1000, y:closes[i]})).filter(p=>p.y!=null);
}

async function loadAllQuotes() {
  const all = CATEGORIES.flatMap(c=>c.tickers);
  await Promise.allSettled(all.map(async t => {
    const q = await fetchQuote(t.sym);
    if(q) cache[t.sym] = q;
  }));
  renderCards();
  document.getElementById('updateTime').textContent = new Date().toLocaleTimeString('ko-KR',{hour:'2-digit',minute:'2-digit',second:'2-digit'});
}

function updateChartColors() {
  if(!chartInstance) return;
  const isDark = document.body.classList.contains('dark');
  const gridColor = isDark ? 'rgba(148,163,184,.15)' : 'rgba(0,0,0,.06)';
  const tickColor = isDark ? '#94a3b8' : '#6b7280';
  chartInstance.options.scales.x.grid.color = gridColor;
  chartInstance.options.scales.y.grid.color = gridColor;
  chartInstance.options.scales.x.ticks.color = tickColor;
  chartInstance.options.scales.y.ticks.color = tickColor;
  chartInstance.update('none');
}

async function selectTicker(sym) {
  selectedTicker = sym;
  renderCards();
  await loadChart(sym, currentRange);
}

function getTickerInfo(sym) {
  for(const c of CATEGORIES) for(const t of c.tickers) if(t.sym===sym) return t;
  return {name:sym,dp:2};
}

async function loadChart(sym, rangeId) {
  currentRange = rangeId;
  const container = document.getElementById('chartContainer');
  container.classList.add('visible');
  const info = getTickerInfo(sym);
  document.getElementById('chartTitle').textContent = info.name + ' (' + sym + ')';

  // Range buttons
  document.getElementById('rangeBtns').innerHTML = RANGES.map(r =>
    `<button class="range-btn ${r.range===rangeId?'active':''}" onclick="loadChart('${sym}','${r.range}')">${r.label}</button>`
  ).join('');

  const rObj = RANGES.find(r=>r.range===rangeId);
  const points = await fetchChart(sym, rObj.range, rObj.interval);

  if(!points||!points.length) {
    document.getElementById('chartInfo').innerHTML = '<span>ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>';
    if(chartInstance){chartInstance.destroy();chartInstance=null;}
    return;
  }

  const first = points[0].y, last = points[points.length-1].y;
  const chg = last-first, chgPct = (chg/first*100);
  const isUp = chg >= 0;
  const color = isUp ? '#ef4444' : '#3b82f6';
  const bgColor = isUp ? 'rgba(239,68,68,.1)' : 'rgba(59,130,246,.1)';
  const isDark = document.body.classList.contains('dark');

  document.getElementById('chartInfo').innerHTML =
    `<span>ì‹œê°€: ${fmt(first,info.dp,info.prefix||'',info.suffix||'')}</span>
     <span>í˜„ì¬: ${fmt(last,info.dp,info.prefix||'',info.suffix||'')}</span>
     <span style="color:${color}">${chg>=0?'+':''}${chg.toFixed(info.dp)} (${chgPct>=0?'+':''}${chgPct.toFixed(2)}%)</span>
     <span>ê³ ê°€: ${fmt(Math.max(...points.map(p=>p.y)),info.dp)}</span>
     <span>ì €ê°€: ${fmt(Math.min(...points.map(p=>p.y)),info.dp)}</span>`;

  if(chartInstance) chartInstance.destroy();
  const ctx = document.getElementById('mainChart').getContext('2d');
  chartInstance = new Chart(ctx, {
    type:'line',
    data:{datasets:[{
      data:points, borderColor:color, backgroundColor:bgColor,
      borderWidth:1.5, pointRadius:0, pointHitRadius:8, fill:true, tension:.1
    }]},
    options:{
      responsive:true, maintainAspectRatio:false, animation:{duration:400},
      plugins:{legend:{display:false},tooltip:{
        mode:'index',intersect:false,
        callbacks:{label:ctx=>`${info.name}: ${fmt(ctx.parsed.y,info.dp,info.prefix||'',info.suffix||'')}`}
      }},
      scales:{
        x:{type:'time',grid:{color:isDark?'rgba(148,163,184,.15)':'rgba(0,0,0,.06)'},
          ticks:{color:isDark?'#94a3b8':'#6b7280',maxTicksLimit:6,font:{size:10}},
          time:{tooltipFormat:'yyyy-MM-dd HH:mm'}},
        y:{grid:{color:isDark?'rgba(148,163,184,.15)':'rgba(0,0,0,.06)'},
          ticks:{color:isDark?'#94a3b8':'#6b7280',font:{size:10},
            callback:v=>fmt(v,info.dp>2?2:info.dp)}}
      },
      interaction:{mode:'index',intersect:false}
    }
  });
}

// Init
renderTabs(); renderCards();
loadAllQuotes();
setInterval(loadAllQuotes, 30000);

// Auto dark mode
if(window.matchMedia('(prefers-color-scheme:dark)').matches) {
  document.body.classList.add('dark');
  document.querySelector('.dark-toggle').textContent = 'â˜€ï¸';
}
</script>
</body>
</html>
